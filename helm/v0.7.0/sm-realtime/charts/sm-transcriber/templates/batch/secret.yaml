{{- if (and (eq "batch" .Values.transcriber.mode) .Values.batch.internalApi.createSecret) }}
{{- if .Values.externalSecrets.enabled }}
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ .Values.batch.internalApi.secretName }}
  namespace: {{ .Release.Namespace }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreName }}
    kind: {{ .Values.externalSecrets.secretStoreKind }}
  target:
    name: {{ .Values.batch.internalApi.secretName }}
  data:
  - secretKey: hmac_shared_keys
    remoteRef:
      key: {{ default "internal-api-secret" (default .Values.batch.internalApi.secretKey) }}
      {{- if eq "vault" .Values.externalSecrets.provider }}
      property: {{ default "hmac_shared_keys" (default .Values.batch.internalApi.secretProperty) }}
      {{- end }}
{{- else }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.batch.internalApi.secretName }}
  namespace: {{ $.Release.Namespace }}
data:
  hmac_shared_keys: {{ .Values.batch.internalApi.hmac }}
{{- end }}
{{- end }}
{{- if (and (eq "batch" .Values.transcriber.mode) .Values.batch.acs.createSecret) }}
{{- if .Values.externalSecrets.enabled }}
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ .Values.batch.acs.secretName }}
  namespace: {{ .Release.Namespace }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreName }}
    kind: {{ .Values.externalSecrets.secretStoreKind }}
  target:
    name: {{ .Values.batch.acs.secretName }}
  data:
  - secretKey: acs-config
    remoteRef:
      key: {{ default "acs-connection-info" (default .Values.batch.acs.secretKey) }}
      {{- if eq "vault" .Values.externalSecrets.provider }}
      property: {{ default "acs-config" (default .Values.batch.acs.secretProperty) }}
      {{- end }}
{{- else }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.batch.acs.secretName }}
  namespace: {{ $.Release.Namespace }}
data:
  acs-config: {{ .Values.batch.acs.config }}
{{- end }}
{{- end }}
{{- if (and (eq "batch" .Values.transcriber.mode) .Values.batch.autoChapters.createSecret) }}
{{- if .Values.externalSecrets.enabled }}
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: {{ .Values.batch.autoChapters.secretName }}
  namespace: {{ .Release.Namespace }}
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: {{ .Values.externalSecrets.secretStoreName }}
    kind: {{ .Values.externalSecrets.secretStoreKind }}
  target:
    name: {{ .Values.batch.autoChapters.secretName }}
  data:
  - secretKey: auto-chapters-config
    remoteRef:
      key: {{ default "auto-chapters-connection-info" (default .Values.batch.autoChapters.secretKey) }}
      {{- if eq "vault" .Values.externalSecrets.provider }}
      property: {{ default "auto-chapters-connection-info" (default .Values.batch.autoChapters.secretProperty) }}
      {{- end }}
{{- else }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.batch.autoChapters.secretName }}
  namespace: {{ $.Release.Namespace }}
data:
  auto-chapters-config: {{ .Values.batch.autoChapters.config }}
{{- end }}
{{- end }}
